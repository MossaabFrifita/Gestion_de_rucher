

<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>Gestion de Rucher</title>
  
  
  <link rel='stylesheet prefetch' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css'>
<link rel='stylesheet prefetch' href='https://cdn.datatables.net/1.10.12/css/dataTables.bootstrap.min.css'>
<link rel='stylesheet prefetch' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css'>
      <link rel="stylesheet" href="{{ asset('css/styleFront.css') }}">


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <style type="text/css">

/* Important part */
#modal-dialogInterv{
    overflow-y: initial !important
}
#modal-bodyInterv{
    height: 450px;

    overflow-y: auto;
}

  </style>
</head>

<body>

<ul>
  <li><a href="">Accueil </a></li>

</ul>



  <div class="container" ng-app="formvalid">
  <div class="panel" data-ng-controller="validationCtrl">
  <div class="panel-heading border">    

       <p> <center><h4>LISTE DE RUCHER
                           </h4>
						   
						   </center>	
 <button  type="button" class="btn btn-danger" id="btnAddRuche" >Add ruche</button></p></br>
  </div>


  
  <div class="panel-body">
      <table class="table table-bordered bordered table-striped table-condensed datatable" ui-jq="dataTable" ui-options="dataTableOpt" id="myTable">
      <thead>
        <tr>
        
          <th>Name</th>
          <th>Position</th>
          <th>Actions</th>

        </tr>
      </thead>
        <tbody id="rucheTab">
        
		{% for liste in listeRuche %}	  
		  <tr>
            <td>{{ liste.getNomRuche }}</td>
            <td>{{ liste.getPosition }}</td>
            <td><center>
			<button class="fa fa-trash-o" aria-hidden="true"></button>
			<button class="fa fa-info-circle" aria-hidden="true" onclick="showIntervention({{ liste.getId }})" ></button>
			</center></td>	
          </tr>
		  
		  {% endfor %}
        </tbody>
    </table>
  </div>
</div>
</div>
  


<script src='https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/js/jquery.dataTables.min.js'></script>
<script src='https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js'></script>


    
<div class="modal" tabindex="-1" role="dialog" id="myModal">
  <div class="modal-dialog" role="document" id="modal-dialogInterv">
    <div class="modal-content">
      <div class="modal-header">
        <strong>Interventions de la ruche</strong>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="modal-bodyInterv">
        <div><button  type="button" class="btn btn-success" id="btnProduction" >Production</button> </div></br></br>
         <table class="table table-bordered bordered table-striped table-condensed datatable" ui-jq="dataTable" ui-options="dataTableOpt" id="myTable2" >
      <thead>
        <tr ">
        
          <th>Intervention</th>
          <th>Date</th>
          

        </tr>
      </thead>
        <tbody>
     
          
        </tbody>
    </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="addinterv">Add intervenation</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal" id ="BtnCShowRuche">Close</button>
      </div>
    </div>
  </div>
</div>



<div class="modal" tabindex="-1" role="dialog" id="myModal2">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        Modal title
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
     <p>sdsdsd</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" >Enregistrer</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Fermer</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="addRuche">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
      <strong>  Ajout d'une nouvelle ruche</strong>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
  <div class="modal-body">

     <div >
      
      <input type="text" class="form-control" placeholder="Nom" id="NomRuche">  </div>
	  <div> </br>
	  <input type="text" class="form-control" placeholder="Position" id="PosRuche"></div>
   

      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success" id="BtnAddRuche">Enregistrer</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal" id ="btnCloseAddRuche">Fermer</button>
      </div>
    </div>
  </div>
</div>
<script   src="{{ asset('js/indexFront.js') }}"></script>
<script   src="{{ asset('js/GererListeRuche.js') }}"></script>
<script   src="{{ asset('js/notify.js') }}"></script>

<script type="text/javascript">
    $("#BtnAddRuche").on( "click", function() {

   $("#NomRuche").css({'background-color' : 'white'});
   $("#PosRuche").css({'background-color' : 'white'});
var nomRuche = $("#NomRuche").val();
var PosRuche = $("#PosRuche").val();
 if (nomRuche == "" && PosRuche == ""){
   $("#NomRuche").css({'background-color' : '#d9534f'});
   $("#PosRuche").css({'background-color' : '#d9534f'});
}
else if(nomRuche == ""){
 $("#NomRuche").css({'background-color' : '#d9534f'});
}
else if(PosRuche == "")
$("#PosRuche").css({'background-color' : '#d9534f'});
else{


var idApiculteur = "{{ idApiculteur }}"
      
    $.ajax({
        type: "POST",
        url: "{{ path('add_ruche')}}",
        cache: false,
        global: false,
        data: {'nomRuche': nomRuche, 'PosRuche': PosRuche, 'idApiculteur': idApiculteur},
       
        success: function(data){

    

 location.reload();
$('#addRuche').modal('hide'); 
    

     $.notify("la ruche a été ajoutée avec succès", "success");


        }
    }); 


       
}// end of else


});
</script>
<script>// script pour fermer le modal ajouter une ruche

$("#btnCloseAddRuche").on("click", function(){

$.notify("l'ajout a été annulé", "info");
});


function format_date(date) { // function to convert timesstamp date to dateTime 

  month=date.getMonth();
  month=month+1; //javascript date goes from 0 to 11
  if (month<10) month="0"+month; //adding the prefix

  year=date.getFullYear();
  day=date.getDate();
  hour=date.getHours();
  minutes=date.getMinutes();
  seconds=date.getSeconds();
  hour = hour-1; // heure de france 
  return day+"/"+month+"/"+year+" "+hour+":"+minutes+":"+seconds;

}



// script pour afficher une intevention


function showIntervention(idRuche){



  





 console.log(idRuche);
 var table4 = $('#myTable2').DataTable({
  "ordering": false
});
 //$('#myTable2').DataTable();


      $.ajax({
        type: "POST",
        url: "{{ path('show_ruche')}}",
        cache: false,
        global: false,
        dataType:"json",
        async: true,
        data: {'IdRuche': idRuche},
       
        success: function(data){
          console.log(data);

if (data.length >= 1){ 

for (var i=0; i<data.length; i++) {

  timestamp = data[i].date.timestamp;
var jsDate = new Date(timestamp*1000);

       table4.rows.add(
       [[ data[i].contenu, format_date(jsDate) ],]
    ).draw();
    
}// end of for
}



$('#myModal').modal('show');


        }// end of success
    }); 

  
}// end of function


$("#BtnCShowRuche").on("click", function(){


   var table4 = $('#myTable2').DataTable();

   table4.destroy();
   $('#myTable2 tbody').empty();

   
});

</script> 



</body>

</html>
